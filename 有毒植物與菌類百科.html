<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¿ æœ‰æ¯’æ¤ç‰©èˆ‡èŒé¡ç™¾ç§‘ - 50ç¨®é›¢ç·šå¢å¼·ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f7f4; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .plant-img-container { position: relative; min-height: 300px; background: #e2e8f0; border-radius: 1.5rem; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .prose strong { color: #065f46; font-weight: 700; }
        .offline-badge { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
    </style>
</head>
<body class="min-h-screen pb-12">

    <header class="bg-emerald-900 text-white py-10 px-4 shadow-xl mb-8">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-4xl font-bold mb-3">ğŸŒ¿ æœ‰æ¯’æ¤ç‰©èˆ‡èŒé¡äº’å‹•ç™¾ç§‘</h1>
            <p class="text-emerald-200 text-lg">AI å°ˆæ¥­åˆ†æ + é›¢ç·šè³‡æ–™åº«é›™æ©Ÿåˆ¶</p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4">
        <section class="mb-10">
            <div class="glass-card p-8 rounded-3xl shadow-lg border border-emerald-100">
                <h2 class="text-xl font-bold mb-4 text-emerald-800 flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    æ™ºæ…§ç‰©ç¨®æŸ¥è©¢
                </h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <input type="text" id="searchInput" placeholder="è¼¸å…¥ç‰©ç¨®åç¨±ï¼Œä¾‹å¦‚ï¼šç´…è±†æ‰ã€æ›¼é™€ç¾…..." 
                        class="flex-1 px-6 py-4 rounded-2xl border-2 border-emerald-50 focus:border-emerald-500 outline-none transition-all text-lg shadow-sm">
                    <button id="searchBtn" onclick="searchPlant()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-10 py-4 rounded-2xl transition-all font-bold text-lg shadow-md flex items-center justify-center gap-2">
                        <span id="btnText">å•Ÿå‹• AI æœå°‹</span>
                        <div id="loader" class="hidden animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"></div>
                    </button>
                </div>
                <div id="searchResult" class="mt-8 hidden p-8 bg-white rounded-3xl border border-emerald-100 shadow-inner"></div>
            </div>
        </section>

        <section>
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <span class="bg-emerald-100 p-2 rounded-lg text-emerald-700 text-xl">ğŸ“–</span>
                    å¸¸è¦‹å±éšªç‰©ç¨® (æ”¯æ´é›¢ç·šé è¦½)
                </h2>
            </div>
            <div id="plantGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>
    </main>

    <script>
        const apiKey = ""; // é è¨­ç•™ç©ºï¼Œä½¿ç”¨ç’°å¢ƒæä¾›ä¹‹é‡‘é‘°

        // é›¢ç·šçŸ¥è­˜åº«å‚™æ¡ˆï¼šå³ä½¿ API Key å¤±æ•ˆï¼Œé€™ 50 ç¨®ç‰©ç¨®ä¹Ÿæœ‰åŸºæœ¬è³‡æ–™
        const plantData = [
            { name: "å¤¾ç«¹æ¡ƒ", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "å¿ƒå¾‹ä¸æ•´ã€åŠ‡çƒˆå˜”åã€è…¹ç—›ï¼Œå«å¼·å¿ƒç”™ã€‚", emergency: "ç«‹å³å‚¬åä¸¦é€é†«ã€‚" },
            { name: "æ¯’è …å‚˜", category: "çœŸèŒ", toxicity: "é«˜", symptom: "å¹»è¦ºã€è‚Œè‚‰æŠ½æã€æµå£æ°´ã€è¦–è¦ºå¤±çœŸã€‚", emergency: "æ´—èƒƒåŠæ´»æ€§ç¢³æ²»ç™‚ã€‚" },
            { name: "æ›¼é™€ç¾…", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "ç³å­”æ”¾å¤§ã€æ„è­˜æ¨¡ç³Šã€å¿ƒè·³éå¿«ã€‚", emergency: "ä½¿ç”¨æŠ—è†½é¹¼åŠ‘æ‹®æŠ—ã€‚" },
            { name: "çƒé ­", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "å…¨èº«éº»ç—ºã€å¿ƒè‡Ÿé©Ÿåœã€å‘¼å¸è¡°ç«­ã€‚", emergency: "æ¥µåº¦å±éšªï¼Œéœ€ç«‹å³é€æ€¥è¨ºã€‚" },
            { name: "æ­»å¸½è‡", category: "çœŸèŒ", toxicity: "æ¥µé«˜", symptom: "æ½›ä¼æœŸé•·ï¼Œéš¨å¾Œå‡ºç¾åŠ‡çƒˆè‚è…è¡°ç«­ã€‚", emergency: "è¡€æ¶²é€æåŠè­·è‚æ²»ç™‚ã€‚" },
            { name: "å§‘å©†èŠ‹", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "å«è‰é…¸éˆ£é‡æ™¶ï¼Œæ¥è§¸è‡´çš®è†šç´…è…«ï¼Œèª¤é£Ÿå£èˆŒåŠ‡ç—›ã€‚", emergency: "ä»¥å¤§é‡æ¸…æ°´æ²–æ´—æˆ–å–å†°ç‰›å¥¶ã€‚" },
            { name: "è“–éº»", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "è“–éº»æ¯’ç´ æœƒå¹²æ“¾è›‹ç™½è³ªåˆæˆï¼Œå™¨å®˜è¡°ç«­ã€‚", emergency: "ç„¡ç‰¹æ•ˆè—¥ï¼Œéœ€ç·Šæ€¥æ”¯æŒæ€§æ²»ç™‚ã€‚" },
            { name: "è˜‡éµ", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "ç¨®å­å«è˜‡éµç´ ï¼Œå¼•èµ·è‚ç¡¬åŒ–åŠç¥ç¶“ç—…è®Šã€‚", emergency: "åˆ‡å‹¿å˜—è©¦é£Ÿç”¨å…¶ç¨®å­ã€‚" },
            { name: "é¦¬éŒ¢å­", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "ç•ªæœ¨é±‰é¹¼å¼•èµ·å…¨èº«ç—™æ”£ã€è§’å¼“åå¼µã€‚", emergency: "é®éœã€å‘¼å¸æ”¯æŒã€é¿å…‰ã€‚" },
            { name: "æµ·æª¬æœ", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "å…¨æ ªæœ‰æ¯’ï¼Œæœå¯¦é¡èŠ’æœï¼Œé£Ÿå¾Œå¿ƒè‡Ÿéº»ç—ºã€‚", emergency: "åš´ç¦é£Ÿç”¨ï¼Œæ¥è§¸å¾Œéœ€æ´—æ‰‹ã€‚" },
            { name: "é•·æ˜¥èŠ±", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "å«ç”Ÿç‰©é¹¼ï¼Œéé‡å°è‡´ç™½è¡€çƒæ¸›å°‘ã€‚", emergency: "é†«ç™‚è§€å¯Ÿã€‚" },
            { name: "æ–·è…¸è‰ (å¤§èŒ¶è—¥)", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "é‰¤å»ç´ è‡´å‘¼å¸è‚Œéº»ç—ºã€çª’æ¯æ­»äº¡ã€‚", emergency: "ç«‹å³æ’ç®¡èˆ‡æ´—èƒƒã€‚" },
            { name: "éˆ´è˜­", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "å½±éŸ¿å¿ƒè‡Ÿé »ç‡ï¼Œå¼•èµ·çœ©æšˆã€å¿ƒæ‚¸ã€‚", emergency: "é†«å­¸ç›£æ§ã€‚" },
            { name: "æ¯›åœ°é»ƒ", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "é»ƒè¦–ç—‡ï¼ˆè¦–åŠ›è®Šé»ƒï¼‰ã€å¿ƒå¾‹å¤±å¸¸ã€‚", emergency: "æ§åˆ¶é›»è§£è³ªå¹³è¡¡ã€‚" },
            { name: "æœéµ‘èŠ±", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "æœ¨è—œè˜†æ¯’ç´ å¼•èµ·ä½è¡€å£“ã€å˜”åã€‚", emergency: "æ”¯æŒæ€§ç™‚æ³•ã€‚" },
            { name: "é¢¨ä¿¡å­", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "çƒè–çš®å±‘è‡´ç™¢ï¼Œèª¤é£Ÿè‡´å¼·çƒˆè…¹ç€‰ã€‚", emergency: "å¤§é‡é£²æ°´ã€‚" },
            { name: "æ°´ä»™èŠ±", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "çŸ³è’œé¹¼å¼•ç™¼åš´é‡èƒƒè…¸ç‚ã€‚", emergency: "è£œå……é›»è§£è³ªã€‚" },
            { name: "å¤§æˆŸ", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "ä¹³æ±å…·å¼·çƒˆè…è•æ€§ï¼Œæå®³ç²˜è†œã€‚", emergency: "è‚¥çš‚æ°´æ²–æ´—ã€‚" },
            { name: "éº’éºŸèŠ±", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "ä¹³æ±è‡´çš®è†šç´…è…«ã€çœ¼éƒ¨ç™¼ç‚ã€‚", emergency: "é¿å…æ¥è§¸æ¶²é«”ã€‚" },
            { name: "è–èª•ç´…", category: "æ¤ç‰©", toxicity: "ä½ä¸­", symptom: "ä¹³æ±å¼•èµ·çš®è†šéæ•ã€å˜”åã€‚", emergency: "ä¸€èˆ¬è§€å¯Ÿã€‚" },
            { name: "è®Šè‘‰æœ¨", category: "æ¤ç‰©", toxicity: "ä½ä¸­", symptom: "ä¹³æ±è‡´è…¹ç€‰ã€ç™¼ç–¹ã€‚", emergency: "å¤§é‡æ¸…æ°´æ²–æ´—ã€‚" },
            { name: "å¸¸æ˜¥è—¤", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "è‘‰ç‰‡èˆ‡æ¼¿æœè‡´å‘¼å¸å›°é›£ã€å–‰é ­æ°´è…«ã€‚", emergency: "ä¿æŒå‘¼å¸é“é€šæš¢ã€‚" },
            { name: "è¬å¹´é’", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "è‰é…¸éˆ£æ™¶é«”è‡´å£èˆŒå¤±è²ã€è…«ç—›ã€‚", emergency: "å£æœå†·é£²ç·©è§£ç—›æ„Ÿã€‚" },
            { name: "é¾œèƒŒèŠ‹", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "æ±æ¶²è‡´çš®è†šç‡’ç¼ã€é»è†œæ½°ç˜ã€‚", emergency: "æ²–æ´—å—å½±éŸ¿éƒ¨ä½ã€‚" },
            { name: "ç™½é¶´èŠ‹", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "ååš¥å›°é›£ã€å£è…”é»è†œæ°´è…«ã€‚", emergency: "é¿å…å¹¼ç«¥åŠå¯µç‰©èª¤é£Ÿã€‚" },
            { name: "é»ƒé‡‘è‘›", category: "æ¤ç‰©", toxicity: "ä½ä¸­", symptom: "èª¤é£Ÿå¼•èµ·æµå£æ°´ã€å˜”åã€‚", emergency: "é€šå¸¸ä¸è‡´å‘½ï¼Œä½†éœ€è§€å¯Ÿã€‚" },
            { name: "ä»™å®¢ä¾†", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "å¡Šè–å«çš‚ç”™ï¼Œè‡´åŠ‡çƒˆè…¹ç—›ã€æŠ½æã€‚", emergency: "æ€¥è¨ºæ²»ç™‚ã€‚" },
            { name: "ç™¾åˆèŠ± (è²“æ¯’æ€§)", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "å°è²“å…·è‡´å‘½è…æ¯’æ€§ï¼Œäººé«”ç—‡ç‹€è¼ƒè¼•ã€‚", emergency: "å¯µç‰©å®¶é•·éœ€æ¥µåº¦å°å¿ƒã€‚" },
            { name: "å­¤æŒºèŠ±", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "é±—è–å¼•èµ·éœ‡é¡«ã€æµæ¶ã€è™›è„«ã€‚", emergency: "å°ç—‡æ²»ç™‚ã€‚" },
            { name: "ç´«è—¤", category: "æ¤ç‰©", toxicity: "ä¸­", symptom: "è±†è¢å«æ¨¹è„‚ï¼Œè‡´å¤§æ±—ã€è™›è„«ã€‚", emergency: "è£œå……ç”Ÿç†é£Ÿé¹½æ°´ã€‚" },
            { name: "ç¹¡çƒèŠ±", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "å«æ°°ç”™ï¼Œå¼•èµ·è¡€ä¾¿ã€è…¹ç—›ã€ä¼‘å…‹ã€‚", emergency: "ç›£æ¸¬æ°§åˆç‹€æ³ã€‚" },
            { name: "å«ç¾è‰", category: "æ¤ç‰©", toxicity: "ä½ä¸­", symptom: "å«å«ç¾è‰é¹¼ï¼Œé•·æœŸæ¥è§¸è‡´æ¯›é«®è„«è½ã€‚", emergency: "æ¸›å°‘å¾’æ‰‹è§¸æ‘¸ã€‚" },
            { name: "ç›¸æ€è±†", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "ç›¸æ€å­æ¯’ç´ ï¼ŒåŠ‡æ¯’ï¼Œä¸€é¡†å³å¯è‡´æ­»ã€‚", emergency: "æ´—èƒƒï¼Œé é˜²ä¼‘å…‹ã€‚" },
            { name: "ç™½éµè†", category: "çœŸèŒ", toxicity: "æ¥µé«˜", symptom: "æ¯€æ»…æ€§è‚æ¯’æ€§ï¼Œæ­»äº¡ç‡ 50% ä»¥ä¸Šã€‚", emergency: "ç·Šæ€¥è‚è‡Ÿç§»æ¤è©•ä¼°ã€‚" },
            { name: "é±—æŸ„ç™½éµè†", category: "çœŸèŒ", toxicity: "æ¥µé«˜", symptom: "å¤©ä½¿ä¹‹ç¿¼ï¼Œå…§è‡Ÿå£æ­»ã€‚", emergency: "åŠ è­·ç—…æˆ¿ç…§è­·ã€‚" },
            { name: "ç´…ç¶²ç‰›è‚èŒ", category: "çœŸèŒ", toxicity: "ä¸­", symptom: "éƒ¨åˆ†å…·ç¥ç¶“æ¯’ï¼Œè‡´è…¹ç€‰åŠå¹»è¦ºã€‚", emergency: "å‚¬åæ²»ç™‚ã€‚" },
            { name: "æ¯’ç´…è‡", category: "çœŸèŒ", toxicity: "ä¸­", symptom: "è¾›è¾£å‘³ï¼Œå¼·çƒˆèƒƒè…¸æ¯’æ€§ã€‚", emergency: "ç¶­æŒæ°´åˆ†ã€‚" },
            { name: "è±¹æ–‘æ¯’éµè†", category: "çœŸèŒ", toxicity: "æ¥µé«˜", symptom: "ç¥ç¶“ç•°å¸¸ã€æ·±åº¦æ˜è¿·ã€‚", emergency: "å‘¼å¸æ”¯æŒã€‚" },
            { name: "ç«ç„°èŒ¸", category: "çœŸèŒ", toxicity: "æ¥µé«˜", symptom: "è§¸æ‘¸å¯è‡´çš®è†šè„«è½ï¼Œé£Ÿç”¨è‡´å¤šå™¨å®˜è¡°ç«­ã€‚", emergency: "çµ•å°ç¦è§¸ï¼Œåš´ç¦é£Ÿç”¨ã€‚" },
            { name: "å¤§é’è¤¶å‚˜", category: "çœŸèŒ", toxicity: "ä¸­é«˜", symptom: "ç¶ è¤¶è‡ï¼Œè‡´è¡€ä¾¿ã€åŠ‡çƒˆå˜”åã€‚", emergency: "é¿å…åœ¨è‰åœ°éš¨æ„æ¡æ‘˜ã€‚" },
            { name: "è±¬ç± è‰", category: "æ¤ç‰©", toxicity: "ä½", symptom: "æœ¬èº«ç„¡ç›´æ¥æ¯’ç´ ï¼Œä½†æ•èŸ²è¢‹æ¶²é«”å…·å¼·é…¸ã€‚", emergency: "ä¸€èˆ¬ç„¡ç¤™ã€‚" },
            { name: "è¦‹è¡€å°å–‰", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "ç®­æ¯’æœ¨ï¼Œä¹³æ±å…¥å‚·å£å¾Œå¿ƒè‡Ÿé©Ÿåœã€‚", emergency: "é¿å…çš®è†šå‚·å£æ¥è§¸ã€‚" },
            { name: "å—å¤©ç«¹", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "å«æ°«æ°°é…¸ï¼Œè‡´è‚Œè‚‰æŠ½æã€æ˜è¿·ã€‚", emergency: "ç¶­æŒä¾›æ°§ã€‚" },
            { name: "å¤©å—æ˜Ÿ", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "å¡Šè–å…·è¾›è¾£åŠ‡æ¯’ï¼Œè‡´å–‰é ­ç‡’ç¼ã€å‘¼å¸é“å—é˜»ã€‚", emergency: "æŠ—éæ•åŠæ°£é“ç¶­æŒã€‚" },
            { name: "æ›¼é™€ç¾…æœ¨", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "å¤§èŠ±æ›¼é™€ç¾…ï¼Œè‡´å¹»ã€å£ä¹¾ã€è¡€å£“æ³¢å‹•ã€‚", emergency: "é†«å­¸ç›£æ¸¬ã€‚" },
            { name: "æ¯’åƒ", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "è˜‡æ ¼æ‹‰åº•ä¹‹æ­»ï¼Œç”±ä¸‹è€Œä¸Šçš„ç¥ç¶“éº»ç—ºã€‚", emergency: "äººå·¥å‘¼å¸æ©Ÿæ”¯æŒã€‚" },
            { name: "ç§‹æ°´ä»™", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "å¤šå™¨å®˜è¡°ç«­ã€éª¨é«“æŠ‘åˆ¶ã€‚", emergency: "åš´å¯†ç›£æ¸¬è¡€è±¡ã€‚" },
            { name: "æ´‹åœ°é»ƒ", category: "æ¤ç‰©", toxicity: "é«˜", symptom: "å…¨æ ªå…·å¼·å¿ƒè‹·ï¼Œè‡´æ­»æ€§å¿ƒå¾‹ä¸æ•´ã€‚", emergency: "å¿ƒé›»åœ–ç›£æ§ã€‚" },
            { name: "æ²™æ¼ ç«ç‘°", category: "æ¤ç‰©", toxicity: "ä¸­é«˜", symptom: "ä¹³æ±å«å¼·å¿ƒç´ ï¼Œè‡´å¿ƒè·³æ¸›æ…¢ã€å˜”åã€‚", emergency: "è‚¥çš‚æ²–æ´—ã€‚" },
            { name: "é›æ¯ç ", category: "æ¤ç‰©", toxicity: "æ¥µé«˜", symptom: "è›‹ç™½è³ªåˆæˆå—é˜»ï¼Œå¼•ç™¼å¾ªç’°è¡°ç«­ã€‚", emergency: "æ€¥è¨ºæ€¥æ•‘ã€‚" }
        ];

        async function fetchImage(plantName) {
            // é¦–å…ˆå˜—è©¦ Wiki
            try {
                const res = await fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(plantName)}`);
                const data = await res.json();
                if (data.thumbnail?.source) return data.thumbnail.source;
            } catch (e) {}

            // Wiki å¤±æ•—æ‰å˜—è©¦ Imagen (ç¯€çœ API é…é¡)
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ instances: [{ prompt: `Botanical scientific clear illustration of ${plantName}` }], parameters: { sampleCount: 1 } })
                });
                const data = await response.json();
                return data.predictions?.[0]?.bytesBase64Encoded ? `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}` : null;
            } catch (e) { return null; }
        }

        async function searchPlant(queryName) {
            const query = queryName || document.getElementById('searchInput').value.trim();
            if (!query) return;

            const resultArea = document.getElementById('searchResult');
            const searchBtn = document.getElementById('searchBtn');
            resultArea.classList.remove('hidden');
            resultArea.innerHTML = `<div class="py-12 flex flex-col items-center"><div class="h-64 w-full max-w-lg shimmer rounded-3xl mb-6"></div><p class="text-emerald-700 animate-pulse">æ­£åœ¨èª¿åº¦ AI å°ˆå®¶é€²è¡Œç‰©ç¨®åˆ†æ...</p></div>`;
            searchBtn.disabled = true;

            // æå–é›¢ç·šå‚™æ¡ˆè³‡æ–™
            const offlineInfo = plantData.find(p => query.includes(p.name)) || null;

            try {
                const [imgUrl, aiResponse] = await Promise.allSettled([
                    fetchImage(query),
                    fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `ä½ æ˜¯ä¸€ä½è³‡æ·±æ¤ç‰©æ¯’ç†å­¸å®¶ã€‚è«‹é‡å°ã€Œ${query}ã€æä¾›è©³ç›¡åˆ†æï¼š1.å­¸å/ç§‘åˆ¥ 2.ä¸»è¦æ¯’æ€§æˆåˆ† 3.è‡¨åºŠä¸­æ¯’ç—‡ç‹€ 4.è¾¨è­˜è¦é» 5.æ€¥æ•‘è™•ç†ã€‚è«‹åˆ†æ®µä¸¦ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚` }] }],
                            tools: [{ "google_search": {} }]
                        })
                    })
                ]);

                let aiContent = "";
                let isOfflineMode = false;

                if (aiResponse.status === "fulfilled") {
                    const data = await aiResponse.value.json();
                    aiContent = data.candidates?.[0]?.content?.parts?.[0]?.text || "";
                }

                // å¦‚æœ AI æ²’å›å‚³å…§å®¹ï¼Œå•Ÿå‹•é›¢ç·šå‚™æ¡ˆ
                if (!aiContent && offlineInfo) {
                    isOfflineMode = true;
                    aiContent = `**[é›¢ç·šè³‡æ–™åº«æ¨¡å¼]**<br><br>**ç‰©ç¨®åˆ†é¡ï¼š** ${offlineInfo.category}<br>**æ¯’æ€§ç­‰ç´šï¼š** ${offlineInfo.toxicity}<br>**è‡¨åºŠç—‡ç‹€ï¼š** ${offlineInfo.symptom}<br>**æ€¥æ•‘å»ºè­°ï¼š** ${offlineInfo.emergency}<br><br>è¨»ï¼šç›®å‰ AI é€£ç·šå—é™ï¼Œä»¥ä¸Šç‚ºç™¾ç§‘é è¼‰ä¹‹åŸºæœ¬å®‰å…¨è³‡è¨Šã€‚`;
                } else if (!aiContent) {
                    aiContent = "âš ï¸ **ç›®å‰ API è«‹æ±‚éæ–¼é »ç¹æˆ–æ¬Šé™å—é™**<br>è«‹ç¨å€™å†è©¦ã€‚å¦‚æœæ‚¨å‰›æ‰å·²é€²è¡Œå¤šæ¬¡æœå°‹ï¼ŒGoogle å¯èƒ½æš«æ™‚é™åˆ¶äº†æ‚¨çš„å­˜å–ã€‚";
                }

                const finalImg = imgUrl.status === "fulfilled" ? imgUrl.value : null;
                const formattedText = aiContent.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

                resultArea.innerHTML = `
                    <div class="flex flex-col lg:flex-row gap-10">
                        <div class="lg:w-2/5 w-full">
                            <div class="plant-img-container shadow-inner border-4 border-white bg-gray-50">
                                ${finalImg ? `<img src="${finalImg}" class="w-full h-full object-cover rounded-2xl">` : `<div class="text-gray-400">ç„¡æ³•è¼‰å…¥å½±åƒ</div>`}
                            </div>
                            ${isOfflineMode ? `<div class="mt-4 p-4 offline-badge rounded-2xl text-sm font-bold text-center">ğŸ“¡ é›¢ç·šå‚™æ¡ˆå…§å®¹å·²å•Ÿå‹•</div>` : ''}
                        </div>
                        <div class="lg:w-3/5 w-full">
                            <h3 class="text-3xl font-black text-emerald-950 mb-4">${query}</h3>
                            <div class="prose max-w-none text-gray-700 bg-emerald-50/50 p-6 rounded-3xl border border-emerald-100 leading-relaxed text-lg">
                                ${formattedText}
                            </div>
                        </div>
                    </div>
                `;
            } catch (err) {
                resultArea.innerHTML = `<div class="p-6 bg-red-50 text-red-700 rounded-2xl">ç³»çµ±ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æ‚¨çš„é‡‘é‘°æ¬Šé™ã€‚</div>`;
            } finally {
                searchBtn.disabled = false;
            }
        }

        function renderPlants() {
            const grid = document.getElementById('plantGrid');
            grid.innerHTML = '';
            plantData.forEach(p => {
                const card = document.createElement('div');
                card.className = 'glass-card p-5 rounded-3xl border border-white hover:border-emerald-500 hover:shadow-xl transition-all cursor-pointer group';
                card.onclick = () => { document.getElementById('searchInput').value = p.name; searchPlant(p.name); window.scrollTo({ top: 0, behavior: 'smooth' }); };
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded">${p.category}</span>
                        <span class="text-[10px] font-bold text-red-600">æ¯’æ€§ ${p.toxicity}</span>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-1 group-hover:text-emerald-700">${p.name}</h3>
                    <p class="text-[11px] text-gray-400 line-clamp-1">${p.symptom}</p>
                `;
                grid.appendChild(card);
            });
        }

        window.onload = renderPlants;
    </script>
</body>
</html>
