<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>綜合計算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f3f4f6;
            padding: 1rem;
        }
        .active-btn {
            background-color: #2563eb;
            color: white;
            border-color: #1d4ed8;
        }
        .input-group {
            display: none; /* Hide all input groups by default */
            transition: all 0.3s ease-in-out;
            transform: translateY(10px);
            opacity: 0;
        }
        .input-group.active {
            display: block; /* Show the active input group */
            transform: translateY(0);
            opacity: 1;
        }
        canvas {
            border: 1px solid #e2e8f0;
            background-color: #ffffff;
            border-radius: 8px;
            margin-top: 1rem;
            display: none; /* Hide canvases by default */
        }
    </style>
</head>
<body>
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg space-y-6 transition-all duration-300">
        <h1 class="text-3xl font-extrabold text-center text-gray-900">綜合計算器</h1>
        <p class="text-center text-gray-600">請選擇您要執行的計算或單位轉換。</p>
        
        <div class="space-y-4">
            <!-- 主要計算功能選擇按鈕 -->
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">選擇計算模式</label>
                <div class="mt-1 flex flex-wrap justify-center gap-2">
                    <button id="calc-power-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">功率 (P)</button>
                    <button id="calc-voltage-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">電壓 (V)</button>
                    <button id="calc-current-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">電流 (I)</button>
                    <button id="calc-torque-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">扭矩 (T)</button>
                    <button id="calc-conversion-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 active-btn whitespace-nowrap">N/m 轉 kgf/m</button>
                    <button id="calc-trig-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">三角函數</button>
                    <button id="calc-hyp-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">直角斜邊</button>
                    <button id="calc-area-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">面積計算</button>
                    <button id="calc-non-right-tri-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">非直角斜邊</button>
                    <button id="calc-arc-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">弧長計算</button>
                    <button id="calc-line-speed-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">線速度</button>
                    <button id="calc-inverter-hz-btn" class="calc-mode-btn flex-1 py-2 px-3 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700 whitespace-nowrap">變頻器HZ</button>
                </div>
            </div>

            <!-- 單位轉換輸入組 (預設激活) -->
            <div id="input-conversion" class="input-group active">
                <label for="conversion-type" class="block text-sm font-medium text-gray-700">選擇轉換類型</label>
                <select id="conversion-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="nm_to_kgf">扭矩：N/m 轉換為 kgf/m</option>
                    <option value="kgf_to_nm">扭矩：kgf/m 轉換為 N/m</option>
                </select>
                <label for="conversion-input" class="block text-sm font-medium text-gray-700 mt-4">輸入數值</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="conversion-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="請輸入數值">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span id="conversion-unit-label" class="text-gray-500 sm:text-sm">N/m</span>
                    </div>
                </div>
            </div>

            <!-- 功率/電壓/電流/RPM 輸入組 (可共用) -->
            <div id="input-power-calc" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">請輸入其中兩項數值來計算第三項。</p>
                <label for="power-input" class="block text-sm font-medium text-gray-700">功率 (P)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="power-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="瓦特">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">W</span>
                    </div>
                </div>
                <label for="voltage-input" class="block text-sm font-medium text-gray-700">電壓 (V)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="voltage-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="伏特">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">V</span>
                    </div>
                </div>
                <label for="current-input" class="block text-sm font-medium text-gray-700">電流 (I)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="current-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="安培">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">A</span>
                    </div>
                </div>
            </div>

            <!-- 扭矩輸入組 (需要功率 P 和轉速 RPM) -->
            <div id="input-torque-calc" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">請輸入功率和轉速以計算扭矩 (Nm)。</p>
                <label for="torque-power-input" class="block text-sm font-medium text-gray-700">功率 (P)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="torque-power-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="瓦特">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">W</span>
                    </div>
                </div>
                <label for="rpm-input" class="block text-sm font-medium text-gray-700">轉速 (RPM)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="rpm-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="每分鐘轉數">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">RPM</span>
                    </div>
                </div>
            </div>

            <!-- 三角函數輸入組 -->
            <div id="input-trig" class="input-group">
                <label for="angle-input" class="block text-sm font-medium text-gray-700">角度</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="angle-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="度數">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">°</span>
                    </div>
                </div>
                <div class="mt-4 flex justify-around space-x-2">
                    <button id="calc-sin-btn" class="trig-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-blue-600 text-white active-btn">sin</button>
                    <button id="calc-cos-btn" class="trig-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700">cos</button>
                    <button id="calc-tan-btn" class="trig-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700">tan</button>
                </div>
            </div>

            <!-- 直角三角形斜邊 (畢氏定理) 輸入組 -->
            <div id="input-hyp" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">計算直角三角形斜邊 $c = \sqrt{a^2 + b^2}$</p>
                <label for="hyp-a-input" class="block text-sm font-medium text-gray-700">直角邊 a (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="hyp-a-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="邊長 a">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <label for="hyp-b-input" class="block text-sm font-medium text-gray-700">直角邊 b (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="hyp-b-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="邊長 b">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <canvas id="hyp-canvas" class="w-full h-auto max-h-56"></canvas>
            </div>

            <!-- 非直角三角形斜邊 (餘弦定理) 輸入組 -->
            <div id="input-non-right-tri" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">計算邊 $c$ (餘弦定理): $c^2 = a^2 + b^2 - 2ab \cos(\theta)$</p>
                <label for="non-right-a-input" class="block text-sm font-medium text-gray-700">邊長 a (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="non-right-a-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="邊長 a">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <label for="non-right-b-input" class="block text-sm font-medium text-gray-700">邊長 b (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="non-right-b-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="邊長 b">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <label for="non-right-angle-input" class="block text-sm font-medium text-gray-700">夾角 &theta; (度)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="non-right-angle-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="角度">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">°</span>
                    </div>
                </div>
                <canvas id="non-right-tri-canvas" class="w-full h-auto max-h-56"></canvas>
            </div>

            <!-- 弧長計算輸入組 -->
            <div id="input-arc" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">計算弧長 $L = R \times \theta \times (\pi / 180)$</p>
                <label for="radius-input" class="block text-sm font-medium text-gray-700">半徑 (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="radius-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="半徑">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <label for="arc-angle-input" class="block text-sm font-medium text-gray-700">角度 (度)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="arc-angle-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="度數">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">°</span>
                    </div>
                </div>
                <canvas id="arc-canvas" class="w-full h-auto max-h-56"></canvas>
            </div>

            <!-- 面積計算輸入組 (包含形狀選擇) -->
            <div id="input-area" class="input-group">
                <div class="flex flex-wrap justify-center gap-2 mt-4">
                    <button id="calc-rect-btn" class="area-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-blue-600 text-white active-btn">矩形</button>
                    <button id="calc-tri-btn" class="area-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700">三角形</button>
                    <button id="calc-trap-btn" class="area-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700">梯形</button>
                    <button id="calc-rhombus-btn" class="area-mode-btn flex-1 py-2 px-4 rounded-md font-medium transition duration-150 ease-in-out text-sm border-2 border-transparent bg-gray-200 text-gray-700">菱形</button>
                </div>

                <!-- 矩形輸入 -->
                <div id="input-rect" class="mt-4">
                    <p class="text-sm font-semibold text-blue-600 mb-2">矩形面積: $A = L \times W$</p>
                    <label for="rect-length-input" class="block text-sm font-medium text-gray-700">長度</label>
                    <div class="mt-1 relative rounded-md shadow-sm mb-3">
                        <input type="number" id="rect-length-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="長度">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                    <label for="rect-width-input" class="block text-sm font-medium text-gray-700">寬度</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="rect-width-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="寬度">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                </div>

                <!-- 三角形輸入 -->
                <div id="input-tri" class="mt-4 hidden">
                    <p class="text-sm font-semibold text-blue-600 mb-2">三角形面積: $A = (\text{底} \times \text{高}) / 2$</p>
                    <label for="tri-base-input" class="block text-sm font-medium text-gray-700">底</label>
                    <div class="mt-1 relative rounded-md shadow-sm mb-3">
                        <input type="number" id="tri-base-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="底">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                    <label for="tri-height-input" class="block text-sm font-medium text-gray-700">高</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="tri-height-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="高">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                </div>

                <!-- 梯形輸入 -->
                <div id="input-trap" class="mt-4 hidden">
                    <p class="text-sm font-semibold text-blue-600 mb-2">梯形面積: $A = (\text{上底} + \text{下底}) \times \text{高} / 2$</p>
                    <label for="trap-base1-input" class="block text-sm font-medium text-gray-700">上底</label>
                    <div class="mt-1 relative rounded-md shadow-sm mb-3">
                        <input type="number" id="trap-base1-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="上底">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                    <label for="trap-base2-input" class="block text-sm font-medium text-gray-700">下底</label>
                    <div class="mt-1 relative rounded-md shadow-sm mb-3">
                        <input type="number" id="trap-base2-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="下底">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                    <label for="trap-height-input" class="block text-sm font-medium text-gray-700">高</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="trap-height-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="高">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                </div>

                <!-- 菱形輸入 -->
                <div id="input-rhombus" class="mt-4 hidden">
                    <p class="text-sm font-semibold text-blue-600 mb-2">菱形面積: $A = (\text{對角線}_1 \times \text{對角線}_2) / 2$</p>
                    <label for="rhombus-diag1-input" class="block text-sm font-medium text-gray-700">對角線 1</label>
                    <div class="mt-1 relative rounded-md shadow-sm mb-3">
                        <input type="number" id="rhombus-diag1-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="對角線 1">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                    <label for="rhombus-diag2-input" class="block text-sm font-medium text-gray-700">對角線 2</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="rhombus-diag2-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="對角線 2">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">mm</span>
                        </div>
                    </div>
                </div>
                <canvas id="area-canvas" class="w-full h-auto max-h-56"></canvas>
            </div>

            <!-- 線速度輸入組 -->
            <div id="input-line-speed" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">計算線速度: $V = \text{圓周} \times \text{RPM}$</p>
                <label for="circumference-input" class="block text-sm font-medium text-gray-700">作業圓周 (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="circumference-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="圓周長">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <label for="line-speed-rpm-input" class="block text-sm font-medium text-gray-700">轉速 (RPM)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="line-speed-rpm-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="每分鐘轉數">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">RPM</span>
                    </div>
                </div>
            </div>

            <!-- 變頻器HZ計算輸入組 -->
            <div id="input-inverter-hz" class="input-group">
                <p class="text-sm font-semibold text-blue-600 mb-2">根據目標速度計算所需變頻器 HZ。</p>
                <label for="max-hz-input" class="block text-sm font-medium text-gray-700">最高頻率 (HZ)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="max-hz-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="例如: 60">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">HZ</span>
                    </div>
                </div>
                <label for="wheel-circumference-input" class="block text-sm font-medium text-gray-700">作業輪圓周 (mm)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="wheel-circumference-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="例如: 314">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm</span>
                    </div>
                </div>
                <label for="motor-rpm-input" class="block text-sm font-medium text-gray-700">馬達轉速 (RPM)</label>
                <div class="mt-1 relative rounded-md shadow-sm mb-3">
                    <input type="number" id="motor-rpm-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="例如: 1800">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">RPM</span>
                    </div>
                </div>
                <label for="working-speed-input" class="block text-sm font-medium text-gray-700">目標作業速度 (mm/min)</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="number" id="working-speed-input" class="block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="目標速度">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">mm/min</span>
                    </div>
                </div>
            </div>
        </div>
        
        <button id="calculate-btn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-lg text-lg font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
            執行計算
        </button>
        
        <div id="result-message" class="mt-4 text-center p-3 rounded-lg bg-indigo-50 border-2 border-indigo-300 text-xl font-bold text-gray-800 transition duration-300 ease-in-out min-h-[50px]">
            請選擇一個計算功能並輸入數值。
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 常數定義 ---
            const NM_TO_KGFM = 0.101971621; // 1 Nm ≈ 0.10197 kgf·m
            const KGFM_TO_NM = 9.80665;    // 1 kgf·m = 9.80665 Nm

            // --- 元素獲取 ---
            const resultMessage = document.getElementById('result-message');
            const calculateBtn = document.getElementById('calculate-btn');
            const calcButtons = document.querySelectorAll('.calc-mode-btn');
            const inputGroups = document.querySelectorAll('.input-group');
            const canvases = document.querySelectorAll('canvas');

            // 獲取所有按鈕 (簡化獲取過程)
            const calcPowerBtn = document.getElementById('calc-power-btn');
            const calcVoltageBtn = document.getElementById('calc-voltage-btn');
            const calcCurrentBtn = document.getElementById('calc-current-btn');
            const calcTorqueBtn = document.getElementById('calc-torque-btn');
            const calcConversionBtn = document.getElementById('calc-conversion-btn');
            const calcTrigBtn = document.getElementById('calc-trig-btn');
            const calcAreaBtn = document.getElementById('calc-area-btn');
            const calcHypBtn = document.getElementById('calc-hyp-btn');
            const calcNonRightTriBtn = document.getElementById('calc-non-right-tri-btn');
            const calcArcBtn = document.getElementById('calc-arc-btn');
            const calcLineSpeedBtn = document.getElementById('calc-line-speed-btn');
            const calcInverterHzBtn = document.getElementById('calc-inverter-hz-btn');

            // 獲取所有輸入組
            const inputPowerCalcGroup = document.getElementById('input-power-calc');
            const inputTorqueCalcGroup = document.getElementById('input-torque-calc');
            const inputConversionGroup = document.getElementById('input-conversion');
            const inputTrigGroup = document.getElementById('input-trig');
            const inputAreaGroup = document.getElementById('input-area');
            const inputHypGroup = document.getElementById('input-hyp');
            const inputNonRightTriGroup = document.getElementById('input-non-right-tri');
            const inputArcGroup = document.getElementById('input-arc');
            const inputLineSpeedGroup = document.getElementById('input-line-speed');
            const inputInverterHzGroup = document.getElementById('input-inverter-hz');

            // 細分輸入框
            const powerInput = document.getElementById('power-input');
            const voltageInput = document.getElementById('voltage-input');
            const currentInput = document.getElementById('current-input');
            const torquePowerInput = document.getElementById('torque-power-input');
            const rpmInput = document.getElementById('rpm-input');
            const angleInput = document.getElementById('angle-input');
            const hypAInput = document.getElementById('hyp-a-input');
            const hypBInput = document.getElementById('hyp-b-input');
            const nonRightAInput = document.getElementById('non-right-a-input');
            const nonRightBInput = document.getElementById('non-right-b-input');
            const nonRightAngleInput = document.getElementById('non-right-angle-input');
            const radiusInput = document.getElementById('radius-input');
            const arcAngleInput = document.getElementById('arc-angle-input');
            const circumferenceInput = document.getElementById('circumference-input');
            const lineSpeedRpmInput = document.getElementById('line-speed-rpm-input');
            const maxHzInput = document.getElementById('max-hz-input');
            const wheelCircumferenceInput = document.getElementById('wheel-circumference-input');
            const motorRpmInput = document.getElementById('motor-rpm-input');
            const workingSpeedInput = document.getElementById('working-speed-input');
            
            // ** 修正：補上三角形輸入框的變數宣告 **
            const triBaseInput = document.getElementById('tri-base-input'); 
            const triHeightInput = document.getElementById('tri-height-input');

            // 單位轉換特定輸入
            const conversionTypeSelect = document.getElementById('conversion-type');
            const conversionInput = document.getElementById('conversion-input');
            const conversionUnitLabel = document.getElementById('conversion-unit-label');
            
            // 面積子輸入組
            const inputRectGroup = document.getElementById('input-rect');
            const inputTriGroup = document.getElementById('input-tri');
            const inputTrapGroup = document.getElementById('input-trap');
            const inputRhombusGroup = document.getElementById('input-rhombus');
            const areaButtons = document.querySelectorAll('.area-mode-btn');

            // 三角函數子按鈕
            const trigButtons = document.querySelectorAll('.trig-mode-btn');
            
            // Canvas Contexts
            const hypCanvas = document.getElementById('hyp-canvas');
            const hypCtx = hypCanvas.getContext('2d');
            const areaCanvas = document.getElementById('area-canvas');
            const areaCtx = areaCanvas.getContext('2d');
            const arcCanvas = document.getElementById('arc-canvas');
            const arcCtx = arcCanvas.getContext('2d');
            const nonRightTriCanvas = document.getElementById('non-right-tri-canvas');
            const nonRightTriCtx = nonRightTriCanvas.getContext('2d');

            // --- 狀態管理 ---
            let calculationType = 'conversion'; // 預設為單位轉換
            let trigFunction = 'sin'; // 預設為 sin
            let areaType = 'rectangle'; // 預設為矩形

            // --- 輔助函數：數字格式化和錯誤處理 ---
            function formatNumber(num) {
                if (num === null || isNaN(num) || !isFinite(num)) return '無效數值';
                return num.toFixed(4).replace(/\.?0+$/, "");
            }

            function clearInputs() {
                inputGroups.forEach(group => {
                    const inputs = group.querySelectorAll('input[type="number"], select');
                    inputs.forEach(input => input.value = '');
                });
            }

            function showCanvas(canvasElement) {
                canvases.forEach(c => c.style.display = 'none');
                if (canvasElement) {
                    canvasElement.style.display = 'block';
                    // 確保 Canvas 在顯示時大小正確
                    const containerWidth = canvasElement.parentNode.clientWidth;
                    canvasElement.width = containerWidth;
                    canvasElement.height = Math.min(containerWidth * 0.5, 200); // 設置最大高度
                }
            }

            // --- UI 狀態切換函數 ---
            function setActiveMode(btnId, type) {
                calcButtons.forEach(btn => btn.classList.remove('active-btn', 'bg-blue-600', 'text-white'));
                const activeBtn = document.getElementById(btnId);
                activeBtn.classList.add('active-btn', 'bg-blue-600', 'text-white');
                calculationType = type;
                
                // 隱藏所有輸入組和 Canvas
                inputGroups.forEach(group => group.classList.remove('active'));
                showCanvas(null); 
                resultMessage.textContent = '點擊「執行計算」查看結果。';

                // 顯示對應的輸入組
                switch (type) {
                    case 'power':
                    case 'voltage':
                    case 'current':
                        inputPowerCalcGroup.classList.add('active');
                        break;
                    case 'torque':
                        inputTorqueCalcGroup.classList.add('active');
                        break;
                    case 'conversion':
                        inputConversionGroup.classList.add('active');
                        break;
                    case 'trig':
                        inputTrigGroup.classList.add('active');
                        break;
                    case 'area':
                        inputAreaGroup.classList.add('active');
                        document.getElementById(`input-${areaType}`).classList.remove('hidden');
                        showCanvas(areaCanvas);
                        drawAreaShape();
                        break;
                    case 'hyp':
                        inputHypGroup.classList.add('active');
                        showCanvas(hypCanvas);
                        drawHypTriangle();
                        break;
                    case 'non-right-tri':
                        inputNonRightTriGroup.classList.add('active');
                        showCanvas(nonRightTriCanvas);
                        drawNonRightTriangle();
                        break;
                    case 'arc':
                        inputArcGroup.classList.add('active');
                        showCanvas(arcCanvas);
                        drawArcSector();
                        break;
                    case 'line-speed':
                        inputLineSpeedGroup.classList.add('active');
                        break;
                    case 'inverter-hz':
                        inputInverterHzGroup.classList.add('active');
                        break;
                }
            }

            function setActiveArea(area, btnId) {
                areaType = area;
                areaButtons.forEach(btn => btn.classList.remove('active-btn', 'bg-blue-600', 'text-white', 'bg-gray-200', 'text-gray-700'));
                areaButtons.forEach(btn => btn.classList.add('bg-gray-200', 'text-gray-700'));
                document.getElementById(btnId).classList.remove('bg-gray-200', 'text-gray-700');
                document.getElementById(btnId).classList.add('active-btn', 'bg-blue-600', 'text-white');

                inputRectGroup.classList.add('hidden');
                inputTriGroup.classList.add('hidden');
                inputTrapGroup.classList.add('hidden');
                inputRhombusGroup.classList.add('hidden');
                document.getElementById(`input-${area}`).classList.remove('hidden');
                drawAreaShape();
            }

            function setActiveTrig(func, btnId) {
                trigFunction = func;
                trigButtons.forEach(btn => btn.classList.remove('active-btn', 'bg-blue-600', 'text-white', 'bg-gray-200', 'text-gray-700'));
                trigButtons.forEach(btn => btn.classList.add('bg-gray-200', 'text-gray-700'));
                document.getElementById(btnId).classList.remove('bg-gray-200', 'text-gray-700');
                document.getElementById(btnId).classList.add('active-btn', 'bg-blue-600', 'text-white');
                resultMessage.textContent = '點擊「執行計算」查看結果。';
            }

            // --- 繪圖函數 ---
            
            function drawShape(canvas, drawCallback, inputs) {
                const width = canvas.width;
                const height = canvas.height;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, width, height);
                ctx.save();
                ctx.translate(width / 2, height / 2);
                drawCallback(ctx, width, height, inputs);
                ctx.restore();
            }

            function drawHypTriangle() {
                drawShape(hypCanvas, (ctx, w, h, inputs) => {
                    const a = parseFloat(hypAInput.value) || 30;
                    const b = parseFloat(hypBInput.value) || 40;
                    if (a <= 0 || b <= 0) return;

                    const maxDim = Math.max(a, b);
                    const scale = (Math.min(w, h) - 40) / maxDim;

                    const scaledA = a * scale;
                    const scaledB = b * scale;

                    const startX = -scaledB / 2;
                    const startY = scaledA / 2;

                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(startX, startY - scaledA);
                    ctx.lineTo(startX + scaledB, startY);
                    ctx.closePath();
                    ctx.strokeStyle = '#2563eb';
                    ctx.fillStyle = 'rgba(37, 99, 235, 0.1)';
                    ctx.lineWidth = 2;
                    ctx.fill();
                    ctx.stroke();

                    // 90 degree mark
                    ctx.fillStyle = '#4b5563';
                    ctx.fillRect(startX, startY - 10, 10, 10);

                    // Labels
                    ctx.font = '12px Inter';
                    ctx.fillStyle = '#1f2937';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('a=' + formatNumber(a) + 'mm', startX - 10, startY - scaledA / 2);
                    ctx.fillText('b=' + formatNumber(b) + 'mm', startX + scaledB / 2, startY + 15);
                    ctx.fillText('c?', startX + scaledB / 2 + 10, startY - scaledA / 2 + 10);
                });
            }

            function drawNonRightTriangle() {
                drawShape(nonRightTriCanvas, (ctx, w, h, inputs) => {
                    const a = parseFloat(nonRightAInput.value) || 45;
                    const b = parseFloat(nonRightBInput.value) || 55;
                    const angle = parseFloat(nonRightAngleInput.value) || 60;
                    if (a <= 0 || b <= 0 || angle <= 0 || angle >= 180) return;

                    const angleRad = angle * Math.PI / 180;
                    const c = Math.sqrt(a * a + b * b - 2 * a * b * Math.cos(angleRad));
                    const maxDim = Math.max(a, b, c);
                    const scale = (Math.min(w, h) - 40) / maxDim * 0.8; // 0.8 to give some space

                    const Bx = b * scale;
                    const By = 0;
                    const Cx = a * Math.cos(angleRad) * scale;
                    const Cy = -a * Math.sin(angleRad) * scale;
                    
                    // Center the triangle
                    const minX = Math.min(0, Bx, Cx);
                    const maxX = Math.max(0, Bx, Cx);
                    const minY = Math.min(0, By, Cy);
                    const maxY = Math.max(0, By, Cy);

                    ctx.translate(-(minX + maxX) / 2, -(minY + maxY) / 2);

                    ctx.beginPath();
                    ctx.moveTo(0, 0); // Point A
                    ctx.lineTo(Bx, By); // Point C
                    ctx.lineTo(Cx, Cy); // Point B
                    ctx.closePath();

                    ctx.strokeStyle = '#ef4444';
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.1)';
                    ctx.lineWidth = 2;
                    ctx.fill();
                    ctx.stroke();

                    // Angle arc
                    ctx.beginPath();
                    ctx.arc(0, 0, 15, -angleRad, 0);
                    ctx.strokeStyle = '#374151';
                    ctx.stroke();

                    // Labels
                    ctx.font = '12px Inter';
                    ctx.fillStyle = '#1f2937';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';

                    // Side a
                    const midAX = (Cx + Bx) / 2;
                    const midAY = (Cy + By) / 2;
                    ctx.fillText('a=' + formatNumber(a) + 'mm', midAX + 5, midAY - 5);
                    
                    // Side b
                    ctx.fillText('b=' + formatNumber(b) + 'mm', Bx / 2, By + 15);
                    
                    // Side c (unknown)
                    ctx.fillText('c?', Cx / 2 - 10, Cy / 2 - 5);
                    
                    // Angle label
                    ctx.fillText(formatNumber(angle) + '°', 25 * Math.cos(angleRad / 2), -25 * Math.sin(angleRad / 2));
                });
            }

            function drawArcSector() {
                drawShape(arcCanvas, (ctx, w, h, inputs) => {
                    const radius = parseFloat(radiusInput.value) || 50;
                    const angle = parseFloat(arcAngleInput.value) || 90;
                    if (radius <= 0 || angle <= 0 || angle > 360) return;

                    const scale = (Math.min(w, h) - 40) / (radius * 2);
                    const scaledR = radius * scale;

                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.arc(0, 0, scaledR, 0, angle * Math.PI / 180);
                    ctx.closePath();
                    
                    ctx.strokeStyle = '#f59e0b';
                    ctx.fillStyle = 'rgba(245, 158, 11, 0.1)';
                    ctx.lineWidth = 2;
                    ctx.fill();
                    ctx.stroke();

                    // Mark arc length
                    ctx.beginPath();
                    ctx.arc(0, 0, scaledR * 1.05, 0, angle * Math.PI / 180);
                    ctx.strokeStyle = '#f97316';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    // Radius line label
                    ctx.font = '12px Inter';
                    ctx.fillStyle = '#1f2937';
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'bottom';
                    ctx.fillText('R=' + formatNumber(radius) + 'mm', 5, -5);

                    // Angle arc
                    ctx.beginPath();
                    ctx.arc(0, 0, scaledR / 4, 0, angle * Math.PI / 180);
                    ctx.strokeStyle = '#374151';
                    ctx.stroke();
                    ctx.fillText(formatNumber(angle) + '°', scaledR / 4 + 5, -5);
                });
            }

            function drawAreaShape() {
                drawShape(areaCanvas, (ctx, w, h, inputs) => {
                    // Reset canvas for drawing area shapes
                    ctx.clearRect(-w/2, -h/2, w, h);
                    
                    ctx.font = '12px Inter';
                    ctx.fillStyle = '#1f2937';
                    ctx.strokeStyle = '#10b981';
                    ctx.lineWidth = 2;
                    ctx.textBaseline = 'middle';
                    ctx.textAlign = 'center';
                    
                    switch (areaType) {
                        case 'rectangle':
                            const rectL = parseFloat(document.getElementById('rect-length-input').value) || 60;
                            const rectW = parseFloat(document.getElementById('rect-width-input').value) || 30;
                            if (rectL <= 0 || rectW <= 0) return;
                            
                            const rectScale = (Math.min(w, h) - 40) / Math.max(rectL, rectW);
                            const scaledRectL = rectL * rectScale * 0.8;
                            const scaledRectW = rectW * rectScale * 0.8;

                            ctx.beginPath();
                            ctx.rect(-scaledRectL / 2, -scaledRectW / 2, scaledRectL, scaledRectW);
                            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
                            ctx.fill();
                            ctx.stroke();
                            
                            ctx.fillText('長: ' + formatNumber(rectL) + 'mm', 0, -scaledRectW / 2 - 10);
                            ctx.save();
                            ctx.rotate(-Math.PI / 2);
                            ctx.fillText('寬: ' + formatNumber(rectW) + 'mm', 0, -scaledRectL / 2 - 10);
                            ctx.restore();
                            break;
                        case 'triangle':
                            // 注意：這裡使用宣告好的 triBaseInput 和 triHeightInput 變數
                            const triBase = parseFloat(triBaseInput.value) || 60;
                            const triHeight = parseFloat(triHeightInput.value) || 40;
                            if (triBase <= 0 || triHeight <= 0) return;

                            const triScale = (Math.min(w, h) - 40) / Math.max(triBase, triHeight) * 0.8;
                            const scaledTriBase = triBase * triScale;
                            const scaledTriHeight = triHeight * triScale;

                            ctx.beginPath();
                            ctx.moveTo(-scaledTriBase / 2, scaledTriHeight / 2);
                            ctx.lineTo(scaledTriBase / 2, scaledTriHeight / 2);
                            ctx.lineTo(0, -scaledTriHeight / 2);
                            ctx.closePath();
                            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
                            ctx.fill();
                            ctx.stroke();
                            
                            ctx.fillText('底: ' + formatNumber(triBase) + 'mm', 0, scaledTriHeight / 2 + 15);
                            ctx.fillText('高: ' + formatNumber(triHeight) + 'mm', -scaledTriBase / 2 - 20, 0);
                            break;
                        case 'trap':
                            const trapB1 = parseFloat(document.getElementById('trap-base1-input').value) || 30;
                            const trapB2 = parseFloat(document.getElementById('trap-base2-input').value) || 60;
                            const trapH = parseFloat(document.getElementById('trap-height-input').value) || 40;
                            if (trapB1 <= 0 || trapB2 <= 0 || trapH <= 0) return;

                            const maxB = Math.max(trapB1, trapB2);
                            const trapScale = (Math.min(w, h) - 40) / Math.max(maxB, trapH) * 0.8;
                            const scaledB1 = trapB1 * trapScale;
                            const scaledB2 = trapB2 * trapScale;
                            const scaledH = trapH * trapScale;

                            ctx.beginPath();
                            ctx.moveTo(-scaledB2 / 2, scaledH / 2);
                            ctx.lineTo(scaledB2 / 2, scaledH / 2);
                            ctx.lineTo(scaledB1 / 2, -scaledH / 2);
                            ctx.lineTo(-scaledB1 / 2, -scaledH / 2);
                            ctx.closePath();
                            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
                            ctx.fill();
                            ctx.stroke();

                            ctx.fillText('上底: ' + formatNumber(trapB1) + 'mm', 0, -scaledH / 2 - 10);
                            ctx.fillText('下底: ' + formatNumber(trapB2) + 'mm', 0, scaledH / 2 + 15);
                            ctx.fillText('高: ' + formatNumber(trapH) + 'mm', -maxB * trapScale / 2 - 10, 0);
                            break;
                        case 'rhombus':
                            const diag1 = parseFloat(document.getElementById('rhombus-diag1-input').value) || 80;
                            const diag2 = parseFloat(document.getElementById('rhombus-diag2-input').value) || 50;
                            if (diag1 <= 0 || diag2 <= 0) return;

                            const rhombScale = (Math.min(w, h) - 40) / Math.max(diag1, diag2) * 0.8;
                            const scaledD1 = diag1 * rhombScale;
                            const scaledD2 = diag2 * rhombScale;

                            ctx.beginPath();
                            ctx.moveTo(0, -scaledD2 / 2); // Top
                            ctx.lineTo(scaledD1 / 2, 0); // Right
                            ctx.lineTo(0, scaledD2 / 2); // Bottom
                            ctx.lineTo(-scaledD1 / 2, 0); // Left
                            ctx.closePath();
                            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
                            ctx.fill();
                            ctx.stroke();
                            
                            ctx.fillText('D1: ' + formatNumber(diag1) + 'mm', scaledD1 / 4, 0);
                            ctx.fillText('D2: ' + formatNumber(diag2) + 'mm', 0, scaledD2 / 2 + 15);
                            break;
                    }
                });
            }


            // --- 主計算邏輯 ---
            function calculate() {
                let result = '';
                let isValid = true;

                try {
                    switch (calculationType) {
                        case 'conversion':
                            const conversionValue = parseFloat(conversionInput.value);
                            const conversionType = conversionTypeSelect.value;
                            if (isNaN(conversionValue) || conversionValue < 0) {
                                isValid = false;
                                result = '請輸入有效的正數值進行轉換。';
                            } else if (conversionType === 'nm_to_kgf') {
                                const kgfm = conversionValue * NM_TO_KGFM;
                                result = `扭矩: ${formatNumber(conversionValue)} N/m = ${formatNumber(kgfm)} kgf/m`;
                            } else if (conversionType === 'kgf_to_nm') {
                                const nm = conversionValue * KGFM_TO_NM;
                                result = `扭矩: ${formatNumber(conversionValue)} kgf/m = ${formatNumber(nm)} N/m`;
                            }
                            break;

                        case 'power':
                        case 'voltage':
                        case 'current':
                            const P = parseFloat(powerInput.value);
                            const V = parseFloat(voltageInput.value);
                            const I = parseFloat(currentInput.value);
                            const count = [P, V, I].filter(val => !isNaN(val)).length;

                            if (count < 2) {
                                isValid = false;
                                result = '請輸入功率 (W)、電壓 (V)、電流 (A) 中的任兩項。';
                            } else if (calculationType === 'power') {
                                if (isNaN(V) || isNaN(I)) { isValid = false; result = '計算功率需要電壓和電流。'; }
                                else { const P_calc = V * I; result = `功率 P = V × I = ${formatNumber(V)} V × ${formatNumber(I)} A = ${formatNumber(P_calc)} W`; }
                            } else if (calculationType === 'voltage') {
                                if (isNaN(P) || isNaN(I)) { isValid = false; result = '計算電壓需要功率和電流。'; }
                                else if (I === 0) { isValid = false; result = '電流不能為零。'; }
                                else { const V_calc = P / I; result = `電壓 V = P / I = ${formatNumber(P)} W / ${formatNumber(I)} A = ${formatNumber(V_calc)} V`; }
                            } else if (calculationType === 'current') {
                                if (isNaN(P) || isNaN(V)) { isValid = false; result = '計算電流需要功率和電壓。'; }
                                else if (V === 0) { isValid = false; result = '電壓不能為零。'; }
                                else { const I_calc = P / V; result = `電流 I = P / V = ${formatNumber(P)} W / ${formatNumber(V)} V = ${formatNumber(I_calc)} A`; }
                            }
                            break;
                            
                        case 'torque':
                            const P_torque = parseFloat(torquePowerInput.value);
                            const N_rpm = parseFloat(rpmInput.value);
                            if (isNaN(P_torque) || isNaN(N_rpm) || P_torque < 0 || N_rpm <= 0) {
                                isValid = false;
                                result = '計算扭矩需要有效的功率 (W) 和轉速 (RPM > 0)。';
                            } else {
                                // 扭矩 T (Nm) = 功率 P (W) / 角速度 ω (rad/s)
                                // ω = N_rpm * (2π / 60)
                                // T = (P * 60) / (2π * N_rpm)
                                const T_nm = (P_torque * 60) / (2 * Math.PI * N_rpm);
                                const T_kgfm = T_nm * NM_TO_KGFM;
                                result = `扭矩 T = ${formatNumber(T_nm)} N/m<br/>約等於 ${formatNumber(T_kgfm)} kgf/m`;
                            }
                            break;

                        case 'trig':
                            const angle = parseFloat(angleInput.value);
                            if (isNaN(angle)) {
                                isValid = false;
                                result = '請輸入有效的角度數值 (度)。';
                            } else {
                                const radians = angle * Math.PI / 180;
                                let calcResult;
                                let formula = '';
                                if (trigFunction === 'sin') {
                                    calcResult = Math.sin(radians);
                                    formula = `$$\\sin(${formatNumber(angle)}^\circ) \\approx ${formatNumber(calcResult)}$$`;
                                } else if (trigFunction === 'cos') {
                                    calcResult = Math.cos(radians);
                                    formula = `$$\\cos(${formatNumber(angle)}^\circ) \\approx ${formatNumber(calcResult)}$$`;
                                } else if (trigFunction === 'tan') {
                                    calcResult = Math.tan(radians);
                                    formula = `$$\\tan(${formatNumber(angle)}^\circ) \\approx ${formatNumber(calcResult)}$$`;
                                }
                                result = `${trigFunction}(${formatNumber(angle)}°): ${formatNumber(calcResult)}`;
                            }
                            break;

                        case 'hyp':
                            const a = parseFloat(hypAInput.value);
                            const b = parseFloat(hypBInput.value);
                            if (isNaN(a) || isNaN(b) || a < 0 || b < 0) {
                                isValid = false;
                                result = '請輸入有效的直角邊長 a 和 b。';
                            } else {
                                const c = Math.sqrt(a * a + b * b);
                                result = `斜邊 c = $\\sqrt{a^2 + b^2} = ${formatNumber(c)}$ mm`;
                                drawHypTriangle();
                            }
                            break;

                        case 'non-right-tri':
                            const na = parseFloat(nonRightAInput.value);
                            const nb = parseFloat(nonRightBInput.value);
                            const nAngle = parseFloat(nonRightAngleInput.value);
                            if (isNaN(na) || isNaN(nb) || isNaN(nAngle) || na <= 0 || nb <= 0 || nAngle <= 0 || nAngle >= 180) {
                                isValid = false;
                                result = '請輸入有效的邊長 a、b 和 0° 到 180° 之間的夾角。';
                            } else {
                                const angleRad = nAngle * Math.PI / 180;
                                const nc2 = na * na + nb * nb - 2 * na * nb * Math.cos(angleRad);
                                if (nc2 < 0) {
                                    isValid = false;
                                    result = '無法構成三角形 (計算結果為負)。';
                                } else {
                                    const nc = Math.sqrt(nc2);
                                    result = `第三邊 c (斜邊) = ${formatNumber(nc)} mm`;
                                    drawNonRightTriangle();
                                }
                            }
                            break;
                            
                        case 'arc':
                            const radius = parseFloat(radiusInput.value);
                            const arcAngle = parseFloat(arcAngleInput.value);
                            if (isNaN(radius) || isNaN(arcAngle) || radius <= 0 || arcAngle < 0) {
                                isValid = false;
                                result = '請輸入有效的半徑 (>0) 和角度 (>=0)。';
                            } else {
                                // 弧長 L = R * θ (弧度)
                                const arcLength = radius * (arcAngle * Math.PI / 180);
                                result = `弧長 L = ${formatNumber(arcLength)} mm`;
                                drawArcSector();
                            }
                            break;
                            
                        case 'line-speed':
                            const circumference = parseFloat(circumferenceInput.value);
                            const lineRpm = parseFloat(lineSpeedRpmInput.value);
                            if (isNaN(circumference) || isNaN(lineRpm) || circumference <= 0 || lineRpm < 0) {
                                isValid = false;
                                result = '請輸入有效的圓周長 (>0) 和轉速 (>=0)。';
                            } else {
                                // 線速度 (mm/min) = 圓周 (mm) * 轉速 (RPM)
                                const speed = circumference * lineRpm;
                                result = `線速度 = ${formatNumber(speed)} mm/min`;
                            }
                            break;

                        case 'inverter-hz':
                            const maxHz = parseFloat(maxHzInput.value);
                            const wheelCircumference = parseFloat(wheelCircumferenceInput.value);
                            const motorRpm = parseFloat(motorRpmInput.value);
                            const workingSpeed = parseFloat(workingSpeedInput.value);

                            if (isNaN(maxHz) || isNaN(wheelCircumference) || isNaN(motorRpm) || isNaN(workingSpeed) || maxHz <= 0 || wheelCircumference <= 0 || motorRpm <= 0 || workingSpeed < 0) {
                                isValid = false;
                                result = '請輸入所有有效的數值 (必須大於 0)。';
                            } else {
                                // 最大線速度 (mm/min) = 作業輪圓周 * 馬達轉速
                                const maxSpeed = wheelCircumference * motorRpm;
                                
                                // 所需 HZ = (目標速度 / 最大速度) * 最大 HZ
                                const requiredHz = (workingSpeed / maxSpeed) * maxHz;

                                if (requiredHz > maxHz) {
                                     result = `<span class="text-red-600">所需 HZ: ${formatNumber(requiredHz)} HZ (超過最高頻率 ${formatNumber(maxHz)} HZ)</span>`;
                                } else {
                                     result = `所需 HZ: ${formatNumber(requiredHz)} HZ`;
                                }
                                result += `<br/>最大線速度: ${formatNumber(maxSpeed)} mm/min`;
                            }
                            break;
                            
                        case 'area':
                            drawAreaShape(); // Update drawing before calculation
                            switch (areaType) {
                                case 'rectangle':
                                    const rectL = parseFloat(document.getElementById('rect-length-input').value);
                                    const rectW = parseFloat(document.getElementById('rect-width-input').value);
                                    if (isNaN(rectL) || isNaN(rectW) || rectL < 0 || rectW < 0) { isValid = false; result = '請輸入有效的長度和寬度。'; }
                                    else { const area = rectL * rectW; result = `矩形面積: ${formatNumber(area)} $mm^2$`; }
                                    break;
                                case 'triangle':
                                    const triBase = parseFloat(triBaseInput.value); // 使用已宣告的變數
                                    const triHeight = parseFloat(triHeightInput.value); // 使用已宣告的變數
                                    if (isNaN(triBase) || isNaN(triHeight) || triBase < 0 || triHeight < 0) { isValid = false; result = '請輸入有效的底和高。'; }
                                    else { const area = (triBase * triHeight) / 2; result = `三角形面積: ${formatNumber(area)} $mm^2$`; }
                                    break;
                                case 'trap':
                                    const trapB1 = parseFloat(document.getElementById('trap-base1-input').value);
                                    const trapB2 = parseFloat(document.getElementById('trap-base2-input').value);
                                    const trapH = parseFloat(document.getElementById('trap-height-input').value);
                                    if (isNaN(trapB1) || isNaN(trapB2) || isNaN(trapH) || trapB1 < 0 || trapB2 < 0 || trapH < 0) { isValid = false; result = '請輸入有效的上底、下底和高。'; }
                                    else { const area = ((trapB1 + trapB2) * trapH) / 2; result = `梯形面積: ${formatNumber(area)} $mm^2$`; }
                                    break;
                                case 'rhombus':
                                    const diag1 = parseFloat(document.getElementById('rhombus-diag1-input').value);
                                    const diag2 = parseFloat(document.getElementById('rhombus-diag2-input').value);
                                    if (isNaN(diag1) || isNaN(diag2) || diag1 < 0 || diag2 < 0) { isValid = false; result = '請輸入有效的兩條對角線長度。'; }
                                    else { const area = (diag1 * diag2) / 2; result = `菱形面積: ${formatNumber(area)} $mm^2$`; }
                                    break;
                            }
                            break;

                        default:
                            isValid = false;
                            result = '請選擇要執行的計算項目。';
                            break;
                    }
                } catch (error) {
                    isValid = false;
                    result = '計算錯誤，請檢查輸入數值是否正確。';
                    console.error(error);
                }

                if (isValid) {
                    resultMessage.className = 'mt-4 text-center p-3 rounded-lg bg-green-50 border-2 border-green-300 text-xl font-bold text-gray-800 transition duration-300 ease-in-out min-h-[50px]';
                } else {
                    resultMessage.className = 'mt-4 text-center p-3 rounded-lg bg-red-50 border-2 border-red-300 text-xl font-bold text-gray-800 transition duration-300 ease-in-out min-h-[50px]';
                }
                resultMessage.innerHTML = result;
            }

            // --- 事件監聽器設定 ---

            // 模式切換
            calcButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const type = btn.id.replace('calc-', '').replace('-btn', '');
                    setActiveMode(btn.id, type);
                });
            });

            // 單位轉換輸入框變動時，更新單位標籤
            conversionTypeSelect.addEventListener('change', () => {
                if (conversionTypeSelect.value === 'nm_to_kgf') {
                    conversionUnitLabel.textContent = 'N/m';
                } else {
                    conversionUnitLabel.textContent = 'kgf/m';
                }
                calculate(); // 自動計算
            });

            // 三角函數模式切換
            trigButtons.forEach(btn => {
                btn.addEventListener('click', () => setActiveTrig(btn.id.replace('calc-', '').replace('-btn', ''), btn.id));
            });

            // 面積模式切換
            areaButtons.forEach(btn => {
                btn.addEventListener('click', () => setActiveArea(btn.id.replace('calc-', '').replace('-btn', ''), btn.id));
            });
            
            // 繪圖監聽器 (當輸入值變更時更新圖形)
            [hypAInput, hypBInput].forEach(input => input.addEventListener('input', drawHypTriangle));
            [nonRightAInput, nonRightBInput, nonRightAngleInput].forEach(input => input.addEventListener('input', drawNonRightTriangle));
            [radiusInput, arcAngleInput].forEach(input => input.addEventListener('input', drawArcSector));
            
            // ** 修正：確保所有變數都已宣告，再加入監聽器 **
            [document.getElementById('rect-length-input'), document.getElementById('rect-width-input'), triBaseInput, triHeightInput, document.getElementById('trap-base1-input'), document.getElementById('trap-base2-input'), document.getElementById('trap-height-input'), document.getElementById('rhombus-diag1-input'), document.getElementById('rhombus-diag2-input')].forEach(input => {
                if(input) { // 安全檢查，確保元素存在
                    input.addEventListener('input', drawAreaShape);
                }
            });

            // 計算按鈕
            calculateBtn.addEventListener('click', calculate);

            // 首次載入時，設定預設模式 (單位轉換)
            setActiveMode('calc-conversion-btn', 'conversion');
            conversionUnitLabel.textContent = 'N/m';
        });

        // 確保 Canvas 在視窗大小改變時重設大小
        window.addEventListener('resize', () => {
            const activeCanvas = document.querySelector('.input-group.active canvas');
            if (activeCanvas) {
                const containerWidth = activeCanvas.parentNode.clientWidth;
                activeCanvas.width = containerWidth;
                activeCanvas.height = Math.min(containerWidth * 0.5, 200);
            }
        });
    </script>
</body>
</html>
